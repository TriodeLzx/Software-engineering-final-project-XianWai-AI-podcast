# 弦外（Xian Wai）登录注册系统使用说明

## 📋 项目概述

本项目为"弦外"智能播客创作工具添加了完整的用户登录和注册功能，采用Flask框架构建Web应用。

## 🚀 快速开始

### 1. 安装依赖

```bash
pip install -r requirements.txt
```

### 2. 配置百度TTS（可选）

如果您要使用文字转语音功能，需要配置百度TTS API密钥。有两种方式：

**方式一：环境变量（推荐）**
```bash
# Windows PowerShell
$env:BAIDU_APP_ID="your_app_id"
$env:BAIDU_API_KEY="your_api_key"
$env:BAIDU_SECRET_KEY="your_secret_key"

# Linux/Mac
export BAIDU_APP_ID="your_app_id"
export BAIDU_API_KEY="your_api_key"
export BAIDU_SECRET_KEY="your_secret_key"
```

**方式二：直接修改app.py**
在 `app.py` 中修改以下变量：
```python
BAIDU_APP_ID = 'your_app_id'
BAIDU_API_KEY = 'your_api_key'
BAIDU_SECRET_KEY = 'your_secret_key'
```

> 注意：如果不配置百度TTS，登录和注册功能仍可使用，但文字转语音功能将不可用。

### 3. 运行应用

```bash
python app.py
```

应用将在 `http://localhost:5000` 启动。

### 4. 访问页面

- **登录页面**: http://localhost:5000/login
- **注册页面**: http://localhost:5000/register
- **主页**: http://localhost:5000/home（需要登录）

## 📁 项目结构

```
Software-engineering-final-project-XianWai-AI-podcast/
├── app.py                      # Flask应用主文件
├── AI_Text_to_Audio.py         # 文字转语音功能
├── requirements.txt            # Python依赖包
├── xianwai.db                  # SQLite数据库（运行后自动创建）
├── uploads/                    # 音频文件存储目录（自动创建）
├── templates/                  # HTML模板文件夹
│   ├── login.html              # 登录页面
│   ├── register.html           # 注册页面
│   └── home.html               # 主界面（文字转语音）
└── static/                     # 静态资源文件夹
    ├── css/
    │   ├── auth.css            # 认证页面样式
    │   └── main.css            # 主界面样式
    └── js/
        ├── auth.js             # 认证页面交互脚本
        └── main.js             # 主界面交互脚本
```

## ✨ 功能特性

### 登录功能
- ✅ 支持用户名或邮箱登录
- ✅ 密码显示/隐藏切换
- ✅ 记住我功能
- ✅ 表单验证和错误提示
- ✅ 响应式设计，支持移动端

### 注册功能
- ✅ 用户名、邮箱、密码注册
- ✅ 密码强度验证（至少6个字符）
- ✅ 密码确认验证
- ✅ 实时表单验证
- ✅ 服务条款同意确认

### 文字转语音功能
- ✅ 文本输入和实时字符计数
- ✅ 多种发音人选择（11种可选）
- ✅ 语速、音调、音量可调
- ✅ 实时音频预览和播放
- ✅ 音频文件下载
- ✅ 自动保存到历史记录

### 历史记录功能
- ✅ 查看所有生成的音频记录
- ✅ 播放历史音频
- ✅ 下载历史音频
- ✅ 删除单条记录
- ✅ 清空所有历史记录

### 安全特性
- ✅ 密码使用Werkzeug进行哈希加密存储
- ✅ Session管理用户登录状态
- ✅ 前后端双重验证
- ✅ SQL注入防护（使用SQLAlchemy ORM）
- ✅ 文件访问权限验证

## 🎨 UI设计特点

- **现代化设计**: 采用渐变背景和毛玻璃效果
- **动画效果**: 流畅的页面过渡和交互动画
- **响应式布局**: 完美适配桌面端和移动端
- **品牌一致性**: 符合"弦外"文艺风格的设计

## 🔧 配置说明

### 修改密钥（重要！）

在生产环境中，请务必修改 `app.py` 中的密钥：

```python
app.config['SECRET_KEY'] = 'your-random-secret-key-here'  # 请更换为随机字符串
```

### 数据库配置

默认使用SQLite数据库，数据库文件会自动创建在项目根目录。

如需使用其他数据库（如MySQL、PostgreSQL），可修改 `app.py` 中的数据库连接字符串：

```python
app.config['SQLALCHEMY_DATABASE_URI'] = 'mysql://user:password@localhost/dbname'
```

## 📝 API接口说明

### POST /login
用户登录接口

**请求体**:
```json
{
    "username": "用户名或邮箱",
    "password": "密码"
}
```

**响应**:
```json
{
    "success": true,
    "message": "登录成功",
    "username": "用户名"
}
```

### POST /register
用户注册接口

**请求体**:
```json
{
    "username": "用户名",
    "email": "邮箱",
    "password": "密码",
    "confirm_password": "确认密码"
}
```

**响应**:
```json
{
    "success": true,
    "message": "注册成功",
    "username": "用户名"
}
```

### GET /logout
用户登出接口

### GET /api/user/info
获取当前用户信息（需要登录）

### POST /api/generate-audio
生成音频接口

**请求体**:
```json
{
    "text": "要转换的文本",
    "voice": 0,
    "speed": 5,
    "pitch": 5,
    "volume": 5
}
```

**响应**:
```json
{
    "success": true,
    "message": "生成成功",
    "audio_url": "/api/audio/filename.mp3",
    "filename": "filename.mp3"
}
```

### GET /api/audio/<filename>
下载音频文件（需要登录）

### GET /api/history
获取历史记录列表（需要登录）

### DELETE /api/history
清空所有历史记录（需要登录）

### DELETE /api/history/<id>
删除单条历史记录（需要登录）

## 🐛 常见问题

### 1. 数据库文件未创建
确保运行 `app.py` 时没有权限问题，数据库文件会自动创建。

### 2. 端口被占用
修改 `app.py` 最后一行中的端口号：
```python
app.run(debug=True, host='0.0.0.0', port=5001)  # 改为其他端口
```

### 3. 静态资源加载失败
确保 `templates` 和 `static` 文件夹在正确的位置，且文件名大小写匹配。

## 🔐 安全建议

1. **生产环境配置**:
   - 修改 `SECRET_KEY` 为随机字符串
   - 使用环境变量存储敏感信息
   - 启用HTTPS

2. **数据库安全**:
   - 定期备份数据库
   - 使用强密码策略
   - 限制数据库访问权限

3. **会话安全**:
   - 设置合理的会话过期时间
   - 使用安全的Cookie设置

## 📞 后续开发建议

1. **功能扩展**:
   - 添加邮箱验证功能
   - 实现密码重置功能
   - 添加用户头像上传
   - 集成第三方登录（微信、QQ等）

2. **性能优化**:
   - 添加Redis缓存
   - 实现数据库连接池
   - 优化前端资源加载

3. **用户体验**:
   - 添加加载动画
   - 优化错误提示
   - 添加键盘快捷键支持

## 📄 许可证

本项目遵循原项目许可证。

